<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Communication Analysis • scMetaLink</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Communication Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scMetaLink</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/quick-start.html">Quick Start Guide</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/theory.html">Theory &amp; Methods</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/production-sensing.html">Production &amp; Sensing Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/communication.html">Communication Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/spatial-analysis.html">Spatial Transcriptomics</a></li>
    <li><a class="dropdown-item" href="../articles/lactate-signaling.html">Lactate Signaling</a></li>
    <li><a class="dropdown-item" href="../articles/visualization.html">Visualization Gallery</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/applications.html">Application Examples</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Zaoqu-Liu/scMetaLink" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Communication Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Zaoqu-Liu/scMetaLink/blob/main/vignettes/communication.Rmd" class="external-link"><code>vignettes/communication.Rmd</code></a></small>
      <div class="d-none name"><code>communication.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This tutorial covers the communication analysis step, where
production and sensing scores are combined to quantify cell-cell
communication via metabolites.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Zaoqu-Liu/scMetaLink" class="external-link">scMetaLink</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load and prepare data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">crc_example</span><span class="op">)</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createScMetaLink.html">createScMetaLink</a></span><span class="op">(</span><span class="va">crc_expr</span>, <span class="va">crc_meta</span>, <span class="st">"cell_type"</span><span class="op">)</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferProduction.html">inferProduction</a></span><span class="op">(</span><span class="va">obj</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferSensing.html">inferSensing</a></span><span class="op">(</span><span class="va">obj</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="understanding-communication-scores">Understanding Communication Scores<a class="anchor" aria-label="anchor" href="#understanding-communication-scores"></a>
</h2>
<p>Communication from <strong>sender</strong> to
<strong>receiver</strong> via <strong>metabolite</strong>:</p>
<pre><code>Sender Cell ──[Production]──▶ Metabolite ──[Sensing]──▶ Receiver Cell
     │                            │                           │
     │                            │                           │
     ▼                            ▼                           ▼
  MPP(m,s)         -----&gt;   Comm(s-&gt;r,m)   &lt;-----         MSC(m,r)</code></pre>
</div>
<div class="section level2">
<h2 id="the-computecommunication-function">The <code>computeCommunication()</code> Function<a class="anchor" aria-label="anchor" href="#the-computecommunication-function"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeCommunication.html">computeCommunication</a></span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"geometric"</span>, <span class="co"># How to combine production and sensing</span></span>
<span>  min_production <span class="op">=</span> <span class="fl">0.1</span>, <span class="co"># Minimum production threshold</span></span>
<span>  min_sensing <span class="op">=</span> <span class="fl">0.1</span>, <span class="co"># Minimum sensing threshold</span></span>
<span>  population.size <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># Weight by cell type abundance</span></span>
<span>  n_permutations <span class="op">=</span> <span class="fl">100</span>, <span class="co"># Permutations for significance</span></span>
<span>  n_cores <span class="op">=</span> <span class="fl">1</span>, <span class="co"># Parallel cores</span></span>
<span>  seed <span class="op">=</span> <span class="fl">42</span>, <span class="co"># Reproducibility</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  17%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================| 100%</span></span></code></pre></div>
<div class="section level3">
<h3 id="parameter-deep-dive">Parameter Deep Dive<a class="anchor" aria-label="anchor" href="#parameter-deep-dive"></a>
</h3>
<div class="section level4">
<h4 id="method-combining-production-and-sensing">1. <code>method</code>: Combining Production and Sensing<a class="anchor" aria-label="anchor" href="#method-combining-production-and-sensing"></a>
</h4>
<p>Three methods to compute communication score:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run with different methods</span></span>
<span><span class="va">obj_geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeCommunication.html">computeCommunication</a></span><span class="op">(</span><span class="va">obj</span>, method <span class="op">=</span> <span class="st">"geometric"</span>, n_permutations <span class="op">=</span> <span class="fl">0</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">obj_prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeCommunication.html">computeCommunication</a></span><span class="op">(</span><span class="va">obj</span>, method <span class="op">=</span> <span class="st">"product"</span>, n_permutations <span class="op">=</span> <span class="fl">0</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">obj_harm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeCommunication.html">computeCommunication</a></span><span class="op">(</span><span class="va">obj</span>, method <span class="op">=</span> <span class="st">"harmonic"</span>, n_permutations <span class="op">=</span> <span class="fl">0</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare total communication strength</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">obj_geom</span><span class="op">@</span><span class="va">communication_scores</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">total_prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">obj_prod</span><span class="op">@</span><span class="va">communication_scores</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">total_harm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">obj_harm</span><span class="op">@</span><span class="va">communication_scores</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">total_geom</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Geometric: sqrt(PxS)"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">50</span>, <span class="st">"YlOrRd"</span><span class="op">)</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">total_prod</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Product: PxS"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">50</span>, <span class="st">"YlOrRd"</span><span class="op">)</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">total_harm</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Harmonic: 2PS/(P+S)"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">50</span>, <span class="st">"YlOrRd"</span><span class="op">)</span>,</span>
<span>  axes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="communication_files/figure-html/method_comparison-1.png" class="r-plt" alt="**Figure 1: Communication Score Method Comparison.** Heatmaps showing total communication strength between cell types using different aggregation methods. Geometric mean (default) provides balanced weighting, product emphasizes strong bilateral signals, and harmonic mean penalizes imbalanced communication." width="100%"><p class="caption">
<strong>Figure 1: Communication Score Method Comparison.</strong>
Heatmaps showing total communication strength between cell types using
different aggregation methods. Geometric mean (default) provides
balanced weighting, product emphasizes strong bilateral signals, and
harmonic mean penalizes imbalanced communication.
</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Method recommendations</strong>:</p>
<table class="table">
<thead><tr class="header">
<th>Method</th>
<th>Formula</th>
<th>Best for</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>geometric</code></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msqrt><mrow><mi>P</mi><mo>×</mo><mi>S</mi></mrow></msqrt><annotation encoding="application/x-tex">\sqrt{P \times S}</annotation></semantics></math></td>
<td>General use, balanced</td>
</tr>
<tr class="even">
<td><code>product</code></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>×</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">P \times S</annotation></semantics></math></td>
<td>Emphasizing strong bilateral signals</td>
</tr>
<tr class="odd">
<td><code>harmonic</code></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mn>2</mn><mi>P</mi><mi>S</mi></mrow><mrow><mi>P</mi><mo>+</mo><mi>S</mi></mrow></mfrac><annotation encoding="application/x-tex">\frac{2PS}{P+S}</annotation></semantics></math></td>
<td>Penalizing imbalanced communication</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="min_production-and-min_sensing-noise-filtering">2. <code>min_production</code> and <code>min_sensing</code>: Noise
Filtering<a class="anchor" aria-label="anchor" href="#min_production-and-min_sensing-noise-filtering"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare different thresholds</span></span>
<span><span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">n_interactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">obj_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeCommunication.html">computeCommunication</a></span><span class="op">(</span><span class="va">obj</span>,</span>
<span>    min_production <span class="op">=</span> <span class="va">t</span>, min_sensing <span class="op">=</span> <span class="va">t</span>,</span>
<span>    n_permutations <span class="op">=</span> <span class="fl">0</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">obj_t</span><span class="op">@</span><span class="va">communication_scores</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">n_interactions</span>,</span>
<span>  names.arg <span class="op">=</span> <span class="va">thresholds</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Threshold (min_production = min_sensing)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Number of Non-zero Interactions"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Effect of Thresholds on Detected Interactions"</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"#64B5F6"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="communication_files/figure-html/thresholds-1.png" class="r-plt" alt="**Figure 2: Effect of Expression Thresholds.** Higher thresholds reduce the number of detected interactions by requiring stronger production and sensing signals. Choose based on desired stringency." width="100%"><p class="caption">
<strong>Figure 2: Effect of Expression Thresholds.</strong> Higher
thresholds reduce the number of detected interactions by requiring
stronger production and sensing signals. Choose based on desired
stringency.
</p>
</div>
<p><strong>Guidelines</strong>: - <code>0.1</code>: Default, moderate
filtering - <code>0.05</code>: More permissive, may include noise -
<code>0.2-0.3</code>: More stringent, for focused analysis</p>
</div>
<div class="section level4">
<h4 id="population-size-cell-type-abundance-weighting">3. <code>population.size</code>: Cell Type Abundance Weighting<a class="anchor" aria-label="anchor" href="#population-size-cell-type-abundance-weighting"></a>
</h4>
<p>When enabled, communication is weighted by cell type abundance:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">Comm</mtext><mtext mathvariant="normal">weighted</mtext></msub><mo>=</mo><mtext mathvariant="normal">Comm</mtext><mo>×</mo><msqrt><mrow><mfrac><msub><mi>n</mi><mtext mathvariant="normal">sender</mtext></msub><mi>N</mi></mfrac><mo>×</mo><mfrac><msub><mi>n</mi><mtext mathvariant="normal">receiver</mtext></msub><mi>N</mi></mfrac></mrow></msqrt></mrow><annotation encoding="application/x-tex">\text{Comm}_{\text{weighted}} = \text{Comm} \times \sqrt{\frac{n_{\text{sender}}}{N} \times \frac{n_{\text{receiver}}}{N}}</annotation></semantics></math></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare with and without population size correction</span></span>
<span><span class="va">obj_no_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeCommunication.html">computeCommunication</a></span><span class="op">(</span><span class="va">obj</span>,</span>
<span>  population.size <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_permutations <span class="op">=</span> <span class="fl">0</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">obj_with_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeCommunication.html">computeCommunication</a></span><span class="op">(</span><span class="va">obj</span>,</span>
<span>  population.size <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_permutations <span class="op">=</span> <span class="fl">0</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Total communication per cell type pair</span></span>
<span><span class="va">total_no_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">obj_no_pop</span><span class="op">@</span><span class="va">communication_scores</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">total_with_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">obj_with_pop</span><span class="op">@</span><span class="va">communication_scores</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Without population size correction:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Without population size correction:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">total_no_pop</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    receiver</span></span>
<span><span class="co">#&gt; sender              Normal Epithelial       T Plasma Normal Fibroblast     CAF</span></span>
<span><span class="co">#&gt;   Normal Epithelial            95.343 105.704 90.919           120.128 119.573</span></span>
<span><span class="co">#&gt;   T                            83.677  94.382 80.301           105.682 105.110</span></span>
<span><span class="co">#&gt;   Plasma                       83.028  93.692 80.557           104.482 103.873</span></span>
<span><span class="co">#&gt;   Normal Fibroblast            91.996 102.945 87.495           114.784 114.247</span></span>
<span><span class="co">#&gt;   CAF                          91.263 101.869 86.869           113.753 113.273</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nWith population size correction:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; With population size correction:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">total_with_pop</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    receiver</span></span>
<span><span class="co">#&gt; sender              Normal Epithelial      T Plasma Normal Fibroblast    CAF</span></span>
<span><span class="co">#&gt;   Normal Epithelial            10.036 14.365  8.737            10.325 10.277</span></span>
<span><span class="co">#&gt;   T                            11.371 16.558  9.962            11.726 11.663</span></span>
<span><span class="co">#&gt;   Plasma                        7.978 11.623  7.066             8.197  8.150</span></span>
<span><span class="co">#&gt;   Normal Fibroblast             7.907 11.422  6.865             8.055  8.017</span></span>
<span><span class="co">#&gt;   CAF                           7.844 11.303  6.816             7.983  7.949</span></span>
<span></span>
<span><span class="co"># Show cell type sizes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nCell type counts:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cell type counts:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">crc_meta</span><span class="op">$</span><span class="va">cell_type</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 B               CAF       Endothelial          Gliacyte </span></span>
<span><span class="co">#&gt;               150               200               100                20 </span></span>
<span><span class="co">#&gt;              Mast          Monocyte Normal Epithelial Normal Fibroblast </span></span>
<span><span class="co">#&gt;                30               120               300               200 </span></span>
<span><span class="co">#&gt; Normal Macrophage          Pericyte            Plasma               SMC </span></span>
<span><span class="co">#&gt;               150                50               250                30 </span></span>
<span><span class="co">#&gt;                 T               TAM  Tumor Epithelial </span></span>
<span><span class="co">#&gt;               500               150               600</span></span></code></pre></div>
<p><strong>When to use <code>population.size = TRUE</code></strong>: -
Tissue-level signaling analysis - When abundant cell types should have
more influence - Comparing communication strength across tissues</p>
<p><strong>When to use <code>population.size = FALSE</code></strong>: -
Cell type potential analysis (independent of abundance) - Comparing rare
vs common cell types fairly</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="statistical-significance-testing">Statistical Significance Testing<a class="anchor" aria-label="anchor" href="#statistical-significance-testing"></a>
</h2>
<div class="section level3">
<h3 id="permutation-test">Permutation Test<a class="anchor" aria-label="anchor" href="#permutation-test"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run with permutation test</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeCommunication.html">computeCommunication</a></span><span class="op">(</span><span class="va">obj</span>, n_permutations <span class="op">=</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |===                                                                   |   4%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  17%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  23%  |                                                                              |=================                                                     |  24%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  40%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  44%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  63%  |                                                                              |=============================================                         |  64%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  77%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |===========================================================           |  84%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================| 100%</span></span>
<span></span>
<span><span class="co"># Check p-value distribution</span></span>
<span><span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">communication_pvalues</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">pvals</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">50</span>, main <span class="op">=</span> <span class="st">"P-value Distribution"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"P-value"</span>, col <span class="op">=</span> <span class="st">"#90CAF9"</span>, border <span class="op">=</span> <span class="st">"white"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0.05</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">"usr"</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">*</span> <span class="fl">0.9</span>, <span class="st">"p = 0.05"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="communication_files/figure-html/permutation-1.png" class="r-plt" alt="**Figure 3: P-value Distribution from Permutation Test.** Histogram of p-values from 100 permutations. A uniform distribution under the null is expected; enrichment near 0 indicates true signals. Red line marks the significance threshold (p=0.05)." width="100%"><p class="caption">
<strong>Figure 3: P-value Distribution from Permutation Test.</strong>
Histogram of p-values from 100 permutations. A uniform distribution
under the null is expected; enrichment near 0 indicates true signals.
Red line marks the significance threshold (p=0.05).
</p>
</div>
</div>
<div class="section level3">
<h3 id="multiple-testing-correction">Multiple Testing Correction<a class="anchor" aria-label="anchor" href="#multiple-testing-correction"></a>
</h3>
<p>Different correction methods vary in stringency. With limited
permutations (as in this tutorial), p-value correction may result in
zero significant interactions:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Different correction methods - show counts</span></span>
<span><span class="va">obj_none</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterSignificantInteractions.html">filterSignificantInteractions</a></span><span class="op">(</span><span class="va">obj</span>, adjust_method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">obj_bh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterSignificantInteractions.html">filterSignificantInteractions</a></span><span class="op">(</span><span class="va">obj</span>, adjust_method <span class="op">=</span> <span class="st">"BH"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Significant interactions by correction method:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Significant interactions by correction method:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  No correction:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obj_none</span><span class="op">@</span><span class="va">significant_interactions</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   No correction: 2754</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  BH correction:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obj_bh</span><span class="op">@</span><span class="va">significant_interactions</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   BH correction: 0</span></span></code></pre></div>
<p><strong>Note</strong>: In real analysis with sufficient permutations
(&gt;1000), BH correction is recommended. For demonstration purposes
with limited permutations, we use no adjustment.</p>
</div>
</div>
<div class="section level2">
<h2 id="filtering-significant-interactions">Filtering Significant Interactions<a class="anchor" aria-label="anchor" href="#filtering-significant-interactions"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For this tutorial, use no adjustment to demonstrate the workflow</span></span>
<span><span class="co"># In real analysis, use adjust_method = "BH" with more permutations</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filterSignificantInteractions.html">filterSignificantInteractions</a></span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  pvalue_threshold <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># Significance level</span></span>
<span>  adjust_method <span class="op">=</span> <span class="st">"none"</span>, <span class="co"># Use "BH" for real analysis</span></span>
<span>  min_score <span class="op">=</span> <span class="fl">0</span> <span class="co"># Minimum communication score</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total significant interactions:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">significant_interactions</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total significant interactions: 2754</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Top interactions:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Top interactions:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">significant_interactions</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"sender"</span>, <span class="st">"receiver"</span>, <span class="st">"metabolite_name"</span>,</span>
<span>  <span class="st">"communication_score"</span>, <span class="st">"pvalue_adjusted"</span></span>
<span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;              sender receiver        metabolite_name communication_score</span></span>
<span><span class="co">#&gt; 1          Monocyte     Mast            Epinephrine           0.9999641</span></span>
<span><span class="co">#&gt; 2 Normal Epithelial   Plasma       5-Androstenediol           0.9992733</span></span>
<span><span class="co">#&gt; 3       Endothelial     Mast      Prostaglandin F1a           0.9903007</span></span>
<span><span class="co">#&gt; 4          Gliacyte        B 12-Keto-leukotriene B4           0.9862472</span></span>
<span><span class="co">#&gt; 5            Plasma   Plasma                Estriol           0.9822572</span></span>
<span><span class="co">#&gt; 6 Normal Macrophage        T    Cholesterol sulfate           0.9768051</span></span>
<span><span class="co">#&gt;   pvalue_adjusted</span></span>
<span><span class="co">#&gt; 1      0.00990099</span></span>
<span><span class="co">#&gt; 2      0.00990099</span></span>
<span><span class="co">#&gt; 3      0.00990099</span></span>
<span><span class="co">#&gt; 4      0.00990099</span></span>
<span><span class="co">#&gt; 5      0.00990099</span></span>
<span><span class="co">#&gt; 6      0.00990099</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exploring-communication-results">Exploring Communication Results<a class="anchor" aria-label="anchor" href="#exploring-communication-results"></a>
</h2>
<div class="section level3">
<h3 id="communication-score-structure">Communication Score Structure<a class="anchor" aria-label="anchor" href="#communication-score-structure"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The communication_scores slot is a 3D array</span></span>
<span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">@</span><span class="va">communication_scores</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dimensions: sender x receiver x metabolite\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dimensions: sender x receiver x metabolite</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 15 15 286</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nCell types:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cell types: Normal Epithelial T Plasma Normal Fibroblast CAF Normal Macrophage TAM B Monocyte Endothelial Pericyte SMC Mast Gliacyte Tumor Epithelial</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMetabolites (first 10):"</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Metabolites (first 10): HMDB0000010 HMDB0000011 HMDB0000015 HMDB0000016 HMDB0000031 HMDB0000034 HMDB0000036 HMDB0000039 HMDB0000042 HMDB0000045</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summarizing-by-cell-type-pairs">Summarizing by Cell Type Pairs<a class="anchor" aria-label="anchor" href="#summarizing-by-cell-type-pairs"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Different aggregation methods</span></span>
<span><span class="va">sum_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarizeCommunicationPairs.html">summarizeCommunicationPairs</a></span><span class="op">(</span><span class="va">obj</span>, aggregate_method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span></span>
<span><span class="va">mean_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarizeCommunicationPairs.html">summarizeCommunicationPairs</a></span><span class="op">(</span><span class="va">obj</span>, aggregate_method <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="va">count_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarizeCommunicationPairs.html">summarizeCommunicationPairs</a></span><span class="op">(</span><span class="va">obj</span>, aggregate_method <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== Sum of Communication Scores ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; === Sum of Communication Scores ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sum_result</span><span class="op">)</span></span>
<span><span class="co">#&gt;                sender          receiver communication_score</span></span>
<span><span class="co">#&gt; 128  Tumor Epithelial Normal Macrophage            52.63050</span></span>
<span><span class="co">#&gt; 199  Tumor Epithelial               TAM            51.99507</span></span>
<span><span class="co">#&gt; 191 Normal Epithelial               TAM            44.71782</span></span>
<span><span class="co">#&gt; 120 Normal Epithelial Normal Macrophage            43.56831</span></span>
<span><span class="co">#&gt; 106 Normal Epithelial Normal Fibroblast            40.51663</span></span>
<span><span class="co">#&gt; 30   Tumor Epithelial               CAF            37.72378</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Mean Communication Score ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Mean Communication Score ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mean_result</span><span class="op">)</span></span>
<span><span class="co">#&gt;          sender receiver communication_score</span></span>
<span><span class="co">#&gt; 59  Endothelial     Mast           0.9903007</span></span>
<span><span class="co">#&gt; 62     Monocyte     Mast           0.8563538</span></span>
<span><span class="co">#&gt; 60     Gliacyte     Mast           0.8530255</span></span>
<span><span class="co">#&gt; 66     Pericyte     Mast           0.8407588</span></span>
<span><span class="co">#&gt; 132    Gliacyte Pericyte           0.8334445</span></span>
<span><span class="co">#&gt; 52     Pericyte Gliacyte           0.8238465</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Number of Significant Interactions ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Number of Significant Interactions ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">count_result</span><span class="op">)</span></span>
<span><span class="co">#&gt;                sender          receiver n_interactions</span></span>
<span><span class="co">#&gt; 128  Tumor Epithelial Normal Macrophage             82</span></span>
<span><span class="co">#&gt; 199  Tumor Epithelial               TAM             80</span></span>
<span><span class="co">#&gt; 106 Normal Epithelial Normal Fibroblast             69</span></span>
<span><span class="co">#&gt; 30   Tumor Epithelial               CAF             67</span></span>
<span><span class="co">#&gt; 113  Tumor Epithelial Normal Fibroblast             65</span></span>
<span><span class="co">#&gt; 191 Normal Epithelial               TAM             63</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-communication-matrix">Get Communication Matrix<a class="anchor" aria-label="anchor" href="#get-communication-matrix"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get aggregated communication matrix</span></span>
<span><span class="va">comm_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCommunicationMatrix.html">getCommunicationMatrix</a></span><span class="op">(</span><span class="va">obj</span>, aggregate_method <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html" class="external-link">heatmap</a></span><span class="op">(</span><span class="va">comm_mat</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">50</span>, <span class="st">"Reds"</span><span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Cell-Cell Communication Strength"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="communication_files/figure-html/matrix-1.png" class="r-plt" alt="**Figure 7: Cell-Cell Communication Matrix.** Aggregated communication strength between all cell type pairs. Rows represent senders, columns represent receivers. Clustering groups cell types with similar communication patterns." width="100%"><p class="caption">
<strong>Figure 7: Cell-Cell Communication Matrix.</strong> Aggregated
communication strength between all cell type pairs. Rows represent
senders, columns represent receivers. Clustering groups cell types with
similar communication patterns.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="analyzing-specific-interactions">Analyzing Specific Interactions<a class="anchor" aria-label="anchor" href="#analyzing-specific-interactions"></a>
</h2>
<div class="section level3">
<h3 id="top-communicating-pairs">Top Communicating Pairs<a class="anchor" aria-label="anchor" href="#top-communicating-pairs"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sig</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">@</span><span class="va">significant_interactions</span></span>
<span></span>
<span><span class="co"># Top sender-receiver pairs</span></span>
<span><span class="va">pair_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">communication_score</span> <span class="op">~</span> <span class="va">sender</span> <span class="op">+</span> <span class="va">receiver</span>, data <span class="op">=</span> <span class="va">sig</span>, FUN <span class="op">=</span> <span class="va">length</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pair_counts</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"n_metabolites"</span></span>
<span><span class="va">pair_counts</span> <span class="op">&lt;-</span> <span class="va">pair_counts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">pair_counts</span><span class="op">$</span><span class="va">n_metabolites</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Top communicating cell type pairs:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Top communicating cell type pairs:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pair_counts</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;                sender          receiver n_metabolites</span></span>
<span><span class="co">#&gt; 128  Tumor Epithelial Normal Macrophage            82</span></span>
<span><span class="co">#&gt; 199  Tumor Epithelial               TAM            80</span></span>
<span><span class="co">#&gt; 106 Normal Epithelial Normal Fibroblast            69</span></span>
<span><span class="co">#&gt; 30   Tumor Epithelial               CAF            67</span></span>
<span><span class="co">#&gt; 113  Tumor Epithelial Normal Fibroblast            65</span></span>
<span><span class="co">#&gt; 191 Normal Epithelial               TAM            63</span></span>
<span><span class="co">#&gt; 120 Normal Epithelial Normal Macrophage            61</span></span>
<span><span class="co">#&gt; 214  Tumor Epithelial  Tumor Epithelial            58</span></span>
<span><span class="co">#&gt; 22  Normal Epithelial               CAF            57</span></span>
<span><span class="co">#&gt; 123          Pericyte Normal Macrophage            47</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="top-metabolite-mediators">Top Metabolite Mediators<a class="anchor" aria-label="anchor" href="#top-metabolite-mediators"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Most frequent metabolites in significant interactions</span></span>
<span><span class="va">met_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sig</span><span class="op">$</span><span class="va">metabolite_name</span><span class="op">)</span></span>
<span><span class="va">met_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">met_counts</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Top metabolite mediators:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Top metabolite mediators:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">met_counts</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 11beta-Hydroxyprogesterone           5-Androstenediol </span></span>
<span><span class="co">#&gt;                         30                         23 </span></span>
<span><span class="co">#&gt;                  Ornithine   7beta-Hydroxycholesterol </span></span>
<span><span class="co">#&gt;                         21                         20 </span></span>
<span><span class="co">#&gt;    Adenosine monophosphate                  Cortisone </span></span>
<span><span class="co">#&gt;                         19                         19 </span></span>
<span><span class="co">#&gt;                  Hydroxide                    Retinal </span></span>
<span><span class="co">#&gt;                         19                         18 </span></span>
<span><span class="co">#&gt;                   L-Fucose     Uridine 5'-diphosphate </span></span>
<span><span class="co">#&gt;                         17                         17 </span></span>
<span><span class="co">#&gt;                Cholesterol                   Cortisol </span></span>
<span><span class="co">#&gt;                         16                         16 </span></span>
<span><span class="co">#&gt;                    Glycine             Hyocholic acid </span></span>
<span><span class="co">#&gt;                         16                         16 </span></span>
<span><span class="co">#&gt;                  L-Proline </span></span>
<span><span class="co">#&gt;                         16</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specific-pathway-focus">Specific Pathway Focus<a class="anchor" aria-label="anchor" href="#specific-pathway-focus"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter for specific metabolites (e.g., amino acids)</span></span>
<span><span class="va">amino_acids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"L-Glutamic acid"</span>, <span class="st">"L-Glutamine"</span>, <span class="st">"L-Alanine"</span>, <span class="st">"Glycine"</span>,</span>
<span>  <span class="st">"L-Serine"</span>, <span class="st">"L-Proline"</span>, <span class="st">"L-Aspartic acid"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">aa_interactions</span> <span class="op">&lt;-</span> <span class="va">sig</span><span class="op">[</span><span class="va">sig</span><span class="op">$</span><span class="va">metabolite_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">amino_acids</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Amino acid-mediated interactions:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">aa_interactions</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Amino acid-mediated interactions: 90</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">aa_interactions</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Summarize</span></span>
<span>  <span class="va">aa_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">communication_score</span> <span class="op">~</span> <span class="va">sender</span> <span class="op">+</span> <span class="va">receiver</span> <span class="op">+</span> <span class="va">metabolite_name</span>,</span>
<span>    data <span class="op">=</span> <span class="va">aa_interactions</span>, FUN <span class="op">=</span> <span class="va">sum</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">aa_summary</span> <span class="op">&lt;-</span> <span class="va">aa_summary</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">aa_summary</span><span class="op">$</span><span class="va">communication_score</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">aa_summary</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;               sender          receiver metabolite_name communication_score</span></span>
<span><span class="co">#&gt; 32          Gliacyte  Tumor Epithelial L-Aspartic acid           0.8443290</span></span>
<span><span class="co">#&gt; 19 Normal Macrophage Normal Macrophage       L-Alanine           0.8136641</span></span>
<span><span class="co">#&gt; 75                 T            Plasma       L-Proline           0.8016842</span></span>
<span><span class="co">#&gt; 22               TAM Normal Macrophage       L-Alanine           0.7858833</span></span>
<span><span class="co">#&gt; 3  Normal Macrophage       Endothelial         Glycine           0.7542903</span></span>
<span><span class="co">#&gt; 57 Normal Macrophage               CAF     L-Glutamine           0.7450304</span></span>
<span><span class="co">#&gt; 60               TAM               CAF     L-Glutamine           0.7300418</span></span>
<span><span class="co">#&gt; 74            Plasma            Plasma       L-Proline           0.7230354</span></span>
<span><span class="co">#&gt; 62 Normal Macrophage Normal Fibroblast     L-Glutamine           0.7166993</span></span>
<span><span class="co">#&gt; 6                TAM       Endothelial         Glycine           0.7160865</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-directional-analysis">Advanced: Directional Analysis<a class="anchor" aria-label="anchor" href="#advanced-directional-analysis"></a>
</h2>
<div class="section level3">
<h3 id="outgoing-communication-as-sender">Outgoing Communication (as Sender)<a class="anchor" aria-label="anchor" href="#outgoing-communication-as-sender"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Which cell types send the most signals?</span></span>
<span><span class="va">outgoing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">communication_score</span> <span class="op">~</span> <span class="va">sender</span>, data <span class="op">=</span> <span class="va">sig</span>, FUN <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">outgoing</span> <span class="op">&lt;-</span> <span class="va">outgoing</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">outgoing</span><span class="op">$</span><span class="va">communication_score</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">outgoing</span><span class="op">$</span><span class="va">communication_score</span>,</span>
<span>  names.arg <span class="op">=</span> <span class="va">outgoing</span><span class="op">$</span><span class="va">sender</span>,</span>
<span>  las <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"#FF7043"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Outgoing Communication Strength"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Total Communication Score"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="communication_files/figure-html/outgoing-1.png" class="r-plt" alt="**Figure 4: Outgoing Communication Strength.** Total communication scores for each cell type acting as a sender. Higher values indicate cell types that produce more metabolites for intercellular signaling." width="100%"><p class="caption">
<strong>Figure 4: Outgoing Communication Strength.</strong> Total
communication scores for each cell type acting as a sender. Higher
values indicate cell types that produce more metabolites for
intercellular signaling.
</p>
</div>
</div>
<div class="section level3">
<h3 id="incoming-communication-as-receiver">Incoming Communication (as Receiver)<a class="anchor" aria-label="anchor" href="#incoming-communication-as-receiver"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Which cell types receive the most signals?</span></span>
<span><span class="va">incoming</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">communication_score</span> <span class="op">~</span> <span class="va">receiver</span>, data <span class="op">=</span> <span class="va">sig</span>, FUN <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">incoming</span> <span class="op">&lt;-</span> <span class="va">incoming</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">incoming</span><span class="op">$</span><span class="va">communication_score</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">incoming</span><span class="op">$</span><span class="va">communication_score</span>,</span>
<span>  names.arg <span class="op">=</span> <span class="va">incoming</span><span class="op">$</span><span class="va">receiver</span>,</span>
<span>  las <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"#42A5F5"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Incoming Communication Strength"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Total Communication Score"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="communication_files/figure-html/incoming-1.png" class="r-plt" alt="**Figure 5: Incoming Communication Strength.** Total communication scores for each cell type acting as a receiver. Higher values indicate cell types that sense/uptake more metabolites from other cells." width="100%"><p class="caption">
<strong>Figure 5: Incoming Communication Strength.</strong> Total
communication scores for each cell type acting as a receiver. Higher
values indicate cell types that sense/uptake more metabolites from other
cells.
</p>
</div>
</div>
<div class="section level3">
<h3 id="net-communication-flow">Net Communication Flow<a class="anchor" aria-label="anchor" href="#net-communication-flow"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Net flow = Outgoing - Incoming</span></span>
<span><span class="va">cell_types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sig</span><span class="op">$</span><span class="va">sender</span>, <span class="va">sig</span><span class="op">$</span><span class="va">receiver</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">net_flow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cell_types</span>, <span class="kw">function</span><span class="op">(</span><span class="va">ct</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sig</span><span class="op">$</span><span class="va">communication_score</span><span class="op">[</span><span class="va">sig</span><span class="op">$</span><span class="va">sender</span> <span class="op">==</span> <span class="va">ct</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">inc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sig</span><span class="op">$</span><span class="va">communication_score</span><span class="op">[</span><span class="va">sig</span><span class="op">$</span><span class="va">receiver</span> <span class="op">==</span> <span class="va">ct</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">-</span> <span class="va">inc</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sort and plot</span></span>
<span><span class="va">net_flow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">net_flow</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">net_flow</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="st">"#FF7043"</span>, <span class="st">"#42A5F5"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">net_flow</span>,</span>
<span>  col <span class="op">=</span> <span class="va">cols</span>, las <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Net Communication Flow"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Outgoing - Incoming"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Net Sender"</span>, <span class="st">"Net Receiver"</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FF7043"</span>, <span class="st">"#42A5F5"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="communication_files/figure-html/net_flow-1.png" class="r-plt" alt="**Figure 6: Net Communication Flow.** Difference between outgoing and incoming communication for each cell type. Positive values (orange) indicate net senders; negative values (blue) indicate net receivers. This reveals which cell types drive vs receive metabolic signals in the tissue." width="100%"><p class="caption">
<strong>Figure 6: Net Communication Flow.</strong> Difference between
outgoing and incoming communication for each cell type. Positive values
(orange) indicate net senders; negative values (blue) indicate net
receivers. This reveals which cell types drive vs receive metabolic
signals in the tissue.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="comparing-conditions-if-available">Comparing Conditions (If Available)<a class="anchor" aria-label="anchor" href="#comparing-conditions-if-available"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If your data has conditions (e.g., tumor vs normal)</span></span>
<span><span class="co"># You can run scMetaLink separately and compare</span></span>
<span></span>
<span><span class="co"># Example workflow:</span></span>
<span><span class="va">obj_tumor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runScMetaLink.html">runScMetaLink</a></span><span class="op">(</span><span class="va">expr_tumor</span>, <span class="va">meta_tumor</span>, <span class="st">"cell_type"</span><span class="op">)</span></span>
<span><span class="va">obj_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runScMetaLink.html">runScMetaLink</a></span><span class="op">(</span><span class="va">expr_normal</span>, <span class="va">meta_normal</span>, <span class="st">"cell_type"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare communication strength</span></span>
<span><span class="va">comm_tumor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCommunicationMatrix.html">getCommunicationMatrix</a></span><span class="op">(</span><span class="va">obj_tumor</span><span class="op">)</span></span>
<span><span class="va">comm_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCommunicationMatrix.html">getCommunicationMatrix</a></span><span class="op">(</span><span class="va">obj_normal</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Differential communication</span></span>
<span><span class="va">diff_comm</span> <span class="op">&lt;-</span> <span class="va">comm_tumor</span> <span class="op">-</span> <span class="va">comm_normal</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="output-summary">Output Summary<a class="anchor" aria-label="anchor" href="#output-summary"></a>
</h2>
<table class="table">
<colgroup>
<col width="27%">
<col width="44%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th>Output</th>
<th>Description</th>
<th>Access</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Communication scores</td>
<td>3D array (sender x receiver x metabolite)</td>
<td><code>obj@communication_scores</code></td>
</tr>
<tr class="even">
<td>P-values</td>
<td>3D array of permutation p-values</td>
<td><code>obj@communication_pvalues</code></td>
</tr>
<tr class="odd">
<td>Significant interactions</td>
<td>Filtered data.frame</td>
<td><code>obj@significant_interactions</code></td>
</tr>
<tr class="even">
<td>Summary matrix</td>
<td>2D aggregated matrix</td>
<td><code>getCommunicationMatrix(obj)</code></td>
</tr>
<tr class="odd">
<td>Pair summary</td>
<td>data.frame by cell type pairs</td>
<td><code>summarizeCommunicationPairs(obj)</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong><a href="spatial-analysis.html">Spatial
Analysis</a></strong>: Spatial transcriptomics support</li>
<li>
<strong><a href="visualization.html">Visualization</a></strong>:
Create publication-ready figures</li>
<li>
<strong><a href="applications.html">Applications</a></strong>:
Real-world analysis examples</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zaoqu Liu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
