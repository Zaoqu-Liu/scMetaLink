<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Production &amp; Sensing Analysis • scMetaLink</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Production &amp; Sensing Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scMetaLink</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01-quick-start.html">Quick Start Guide</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/02-theory.html">Theory &amp; Methods</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/03-production-sensing.html">Production &amp; Sensing Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/04-communication.html">Communication Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/05-visualization.html">Visualization Gallery</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/06-applications.html">Application Examples</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Zaoqu-Liu/scMetaLink" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Production &amp; Sensing Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Zaoqu-Liu/scMetaLink/blob/HEAD/vignettes/03-production-sensing.Rmd" class="external-link"><code>vignettes/03-production-sensing.Rmd</code></a></small>
      <div class="d-none name"><code>03-production-sensing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This tutorial provides a deep dive into the production and sensing
inference steps, explaining each parameter and showing how to interpret
the results.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Zaoqu-Liu/scMetaLink" class="external-link">scMetaLink</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load example data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">crc_example</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create object</span></span>
<span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createScMetaLink.html">createScMetaLink</a></span><span class="op">(</span><span class="va">crc_expr</span>, <span class="va">crc_meta</span>, <span class="st">"cell_type"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="part-1-metabolite-production-potential">Part 1: Metabolite Production Potential<a class="anchor" aria-label="anchor" href="#part-1-metabolite-production-potential"></a>
</h2>
<div class="section level3">
<h3 id="understanding-production">Understanding Production<a class="anchor" aria-label="anchor" href="#understanding-production"></a>
</h3>
<p><strong>Production potential</strong> reflects a cell type’s capacity
to: 1. <strong>Synthesize</strong> metabolites via enzymatic reactions
2. <strong>Secrete/release</strong> metabolites to the extracellular
space</p>
<p><img src="03-production-sensing_files/figure-html/prod_concept-1.png" alt="" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="the-inferproduction-function">The <code>inferProduction()</code> Function<a class="anchor" aria-label="anchor" href="#the-inferproduction-function"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferProduction.html">inferProduction</a></span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"combined"</span>,           <span class="co"># Expression scoring method</span></span>
<span>  mean_method <span class="op">=</span> <span class="st">"arithmetic"</span>,    <span class="co"># Mean calculation method</span></span>
<span>  min_expression <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># Minimum expression threshold</span></span>
<span>  min_pct <span class="op">=</span> <span class="fl">0.1</span>,                 <span class="co"># Minimum % of expressing cells</span></span>
<span>  consider_degradation <span class="op">=</span> <span class="cn">TRUE</span>,   <span class="co"># Account for degradation enzymes</span></span>
<span>  consider_secretion <span class="op">=</span> <span class="cn">TRUE</span>,     <span class="co"># Weight by extracellular localization</span></span>
<span>  normalize <span class="op">=</span> <span class="cn">TRUE</span>,              <span class="co"># Normalize across cell types</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parameter-deep-dive">Parameter Deep Dive<a class="anchor" aria-label="anchor" href="#parameter-deep-dive"></a>
</h3>
<div class="section level4">
<h4 id="method-expression-scoring">1. <code>method</code>: Expression Scoring<a class="anchor" aria-label="anchor" href="#method-expression-scoring"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare different scoring methods</span></span>
<span><span class="va">obj_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferProduction.html">inferProduction</a></span><span class="op">(</span><span class="va">obj</span>, method <span class="op">=</span> <span class="st">"mean"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">obj_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferProduction.html">inferProduction</a></span><span class="op">(</span><span class="va">obj</span>, method <span class="op">=</span> <span class="st">"proportion"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">obj_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferProduction.html">inferProduction</a></span><span class="op">(</span><span class="va">obj</span>, method <span class="op">=</span> <span class="st">"combined"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare for lactate</span></span>
<span><span class="va">lactate_id</span> <span class="op">&lt;-</span> <span class="st">"HMDB0000190"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">lactate_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">obj_mean</span><span class="op">@</span><span class="va">production_scores</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">obj_mean</span><span class="op">@</span><span class="va">production_scores</span><span class="op">[</span><span class="va">lactate_id</span>, <span class="op">]</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>          las <span class="op">=</span> <span class="fl">2</span>, main <span class="op">=</span> <span class="st">"method = 'mean'"</span>, col <span class="op">=</span> <span class="st">"#64B5F6"</span>, cex.names <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">obj_prop</span><span class="op">@</span><span class="va">production_scores</span><span class="op">[</span><span class="va">lactate_id</span>, <span class="op">]</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>          las <span class="op">=</span> <span class="fl">2</span>, main <span class="op">=</span> <span class="st">"method = 'proportion'"</span>, col <span class="op">=</span> <span class="st">"#81C784"</span>, cex.names <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">obj_comb</span><span class="op">@</span><span class="va">production_scores</span><span class="op">[</span><span class="va">lactate_id</span>, <span class="op">]</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>          las <span class="op">=</span> <span class="fl">2</span>, main <span class="op">=</span> <span class="st">"method = 'combined'"</span>, col <span class="op">=</span> <span class="st">"#FFB74D"</span>, cex.names <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="03-production-sensing_files/figure-html/method_comparison-1.png" alt="**Figure 1: Expression Scoring Method Comparison.** Lactate production potential across cell types using three different scoring methods. 'mean' uses average expression, 'proportion' uses percentage of expressing cells, and 'combined' multiplies both for a balanced score." width="100%"><p class="caption">
<strong>Figure 1: Expression Scoring Method Comparison.</strong> Lactate
production potential across cell types using three different scoring
methods. ‘mean’ uses average expression, ‘proportion’ uses percentage of
expressing cells, and ‘combined’ multiplies both for a balanced score.
</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Recommendations</strong>: - <code>combined</code>: Best for
most cases, balances expression level and consistency -
<code>mean</code>: When you trust raw expression values -
<code>proportion</code>: When dropout is severe and you only care about
on/off</p>
</div>
<div class="section level4">
<h4 id="mean_method-robust-mean-calculation">2. <code>mean_method</code>: Robust Mean Calculation<a class="anchor" aria-label="anchor" href="#mean_method-robust-mean-calculation"></a>
</h4>
<p>For single-cell data with high dropout and outliers,
<strong>trimean</strong> provides robustness:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare arithmetic vs trimean</span></span>
<span><span class="va">obj_arith</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferProduction.html">inferProduction</a></span><span class="op">(</span><span class="va">obj</span>, mean_method <span class="op">=</span> <span class="st">"arithmetic"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">obj_trim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferProduction.html">inferProduction</a></span><span class="op">(</span><span class="va">obj</span>, mean_method <span class="op">=</span> <span class="st">"trimean"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Correlation between methods</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obj_arith</span><span class="op">@</span><span class="va">production_scores</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cor_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">obj_arith</span><span class="op">@</span><span class="va">production_scores</span><span class="op">)</span>, </span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">obj_trim</span><span class="op">@</span><span class="va">production_scores</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Correlation between arithmetic and trimean:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cor_val</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Correlation between arithmetic and trimean: 0.786</span></span></code></pre></div>
<p><strong>When to use trimean</strong>: - High dropout rates (&gt;50%)
- Suspected outlier cells - When standard mean seems unstable</p>
</div>
<div class="section level4">
<h4 id="consider_degradation-accounting-for-metabolite-turnover">3. <code>consider_degradation</code>: Accounting for Metabolite
Turnover<a class="anchor" aria-label="anchor" href="#consider_degradation-accounting-for-metabolite-turnover"></a>
</h4>
<p>When <code>TRUE</code>, production score is adjusted by subtracting
degradation enzyme expression:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">Production</mtext><mtext mathvariant="normal">net</mtext></msub><mo>=</mo><msub><mtext mathvariant="normal">Production</mtext><mtext mathvariant="normal">raw</mtext></msub><mo>−</mo><mn>0.5</mn><mo>×</mo><mtext mathvariant="normal">Degradation</mtext></mrow><annotation encoding="application/x-tex">\text{Production}_{\text{net}} = \text{Production}_{\text{raw}} - 0.5 \times \text{Degradation}</annotation></semantics></math></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj_with_deg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferProduction.html">inferProduction</a></span><span class="op">(</span><span class="va">obj</span>, consider_degradation <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">obj_no_deg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferProduction.html">inferProduction</a></span><span class="op">(</span><span class="va">obj</span>, consider_degradation <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># See the effect</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"With degradation adjustment:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; With degradation adjustment:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">obj_with_deg</span><span class="op">@</span><span class="va">production_scores</span><span class="op">[</span><span class="st">"HMDB0000190"</span>, <span class="op">]</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Monocyte          Gliacyte               TAM Normal Macrophage </span></span>
<span><span class="co">#&gt;         0.9375074         0.5305421         0.5021831         0.4832566 </span></span>
<span><span class="co">#&gt;  Tumor Epithelial Normal Epithelial </span></span>
<span><span class="co">#&gt;         0.3845369         0.3664723</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nWithout degradation adjustment:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Without degradation adjustment:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">obj_no_deg</span><span class="op">@</span><span class="va">production_scores</span><span class="op">[</span><span class="st">"HMDB0000190"</span>, <span class="op">]</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Normal Fibroblast               CAF          Monocyte               SMC </span></span>
<span><span class="co">#&gt;         0.6240821         0.6076395         0.5739714         0.5331675 </span></span>
<span><span class="co">#&gt;               TAM Normal Macrophage </span></span>
<span><span class="co">#&gt;         0.5177441         0.5003088</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="consider_secretion-extracellular-localization">4. <code>consider_secretion</code>: Extracellular Localization<a class="anchor" aria-label="anchor" href="#consider_secretion-extracellular-localization"></a>
</h4>
<p>When <code>TRUE</code>, metabolites known to be extracellular receive
full weight (1.0), while intracellular metabolites are downweighted
(0.5):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check extracellular metabolites</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">scMetaLink</span><span class="fu">:::</span><span class="fu"><a href="../reference/dot-load_metalinksdb.html">.load_metalinksdb</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">extra_mets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">db</span><span class="op">$</span><span class="va">cell_location</span><span class="op">$</span><span class="va">hmdb</span><span class="op">[</span><span class="va">db</span><span class="op">$</span><span class="va">cell_location</span><span class="op">$</span><span class="va">cell_location</span> <span class="op">==</span> <span class="st">"Extracellular"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of extracellular metabolites:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">extra_mets</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of extracellular metabolites: 1128</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Sample:"</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">db</span><span class="op">$</span><span class="va">metabolites</span><span class="op">$</span><span class="va">metabolite</span><span class="op">[</span><span class="va">db</span><span class="op">$</span><span class="va">metabolites</span><span class="op">$</span><span class="va">hmdb</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">extra_mets</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sample: Sulfate Oxoglutaric acid Calcium Glycerol 17alpha-Estradiol Acetaldehyde</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="exploring-production-results">Exploring Production Results<a class="anchor" aria-label="anchor" href="#exploring-production-results"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get production score matrix</span></span>
<span><span class="va">prod_scores</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">@</span><span class="va">production_scores</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Production score matrix dimensions:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">prod_scores</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Production score matrix dimensions: 790 15</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Metabolites:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">prod_scores</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Metabolites: 790</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Cell types:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">prod_scores</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cell types: 15</span></span>
<span></span>
<span><span class="co"># Top producing cell types for key metabolites</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Top Lactate Producers ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Top Lactate Producers ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/getTopProducers.html">getTopProducers</a></span><span class="op">(</span><span class="va">obj</span>, <span class="st">"L-Lactic acid"</span>, top_n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           cell_type production_score rank</span></span>
<span><span class="co">#&gt; 1          Monocyte        0.9375074    1</span></span>
<span><span class="co">#&gt; 2          Gliacyte        0.5305421    2</span></span>
<span><span class="co">#&gt; 3               TAM        0.5021831    3</span></span>
<span><span class="co">#&gt; 4 Normal Macrophage        0.4832566    4</span></span>
<span><span class="co">#&gt; 5  Tumor Epithelial        0.3845369    5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Top ATP Producers ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Top ATP Producers ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/getTopProducers.html">getTopProducers</a></span><span class="op">(</span><span class="va">obj</span>, <span class="st">"Adenosine triphosphate"</span>, top_n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           cell_type production_score rank</span></span>
<span><span class="co">#&gt; 1               SMC        0.6306768    1</span></span>
<span><span class="co">#&gt; 2          Pericyte        0.6202034    2</span></span>
<span><span class="co">#&gt; 3               CAF        0.5758405    3</span></span>
<span><span class="co">#&gt; 4 Normal Macrophage        0.5673444    4</span></span>
<span><span class="co">#&gt; 5               TAM        0.5539278    5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-production-patterns">Visualizing Production Patterns<a class="anchor" aria-label="anchor" href="#visualizing-production-patterns"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Heatmap of production scores for top variable metabolites</span></span>
<span><span class="va">prod_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">prod_scores</span>, <span class="fl">1</span>, <span class="va">var</span><span class="op">)</span></span>
<span><span class="va">top_mets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">prod_var</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Simple heatmap</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/heatmap.html" class="external-link">heatmap</a></span><span class="op">(</span><span class="va">prod_scores</span><span class="op">[</span><span class="va">top_mets</span>, <span class="op">]</span>, </span>
<span>        scale <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">50</span>, <span class="st">"RdYlBu"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        margins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Production Potential (Top 30 Variable Metabolites)"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="03-production-sensing_files/figure-html/prod_heatmap-1.png" alt="**Figure 2: Production Potential Heatmap.** Top 30 metabolites with highest variance across cell types. Row-scaled values show relative production potential. Clustering reveals cell types with similar metabolic production profiles." width="100%"><p class="caption">
<strong>Figure 2: Production Potential Heatmap.</strong> Top 30
metabolites with highest variance across cell types. Row-scaled values
show relative production potential. Clustering reveals cell types with
similar metabolic production profiles.
</p>
</div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="part-2-metabolite-sensing-capability">Part 2: Metabolite Sensing Capability<a class="anchor" aria-label="anchor" href="#part-2-metabolite-sensing-capability"></a>
</h2>
<div class="section level3">
<h3 id="understanding-sensing">Understanding Sensing<a class="anchor" aria-label="anchor" href="#understanding-sensing"></a>
</h3>
<p><strong>Sensing capability</strong> reflects a cell type’s capacity
to: 1. <strong>Detect</strong> metabolites via membrane receptors
(GPCRs, ion channels, etc.) 2. <strong>Uptake</strong> metabolites via
transporters</p>
<p><img src="03-production-sensing_files/figure-html/sens_concept-1.png" alt="" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="the-infersensing-function">The <code>inferSensing()</code> Function<a class="anchor" aria-label="anchor" href="#the-infersensing-function"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferSensing.html">inferSensing</a></span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"combined"</span>,           <span class="co"># Expression scoring method</span></span>
<span>  mean_method <span class="op">=</span> <span class="st">"arithmetic"</span>,    <span class="co"># Mean calculation method</span></span>
<span>  min_expression <span class="op">=</span> <span class="fl">0</span>,            <span class="co"># Minimum expression threshold</span></span>
<span>  min_pct <span class="op">=</span> <span class="fl">0.1</span>,                 <span class="co"># Minimum % of expressing cells</span></span>
<span>  weight_by_affinity <span class="op">=</span> <span class="cn">TRUE</span>,     <span class="co"># Weight by binding affinity</span></span>
<span>  include_transporters <span class="op">=</span> <span class="cn">TRUE</span>,   <span class="co"># Include uptake transporters</span></span>
<span>  use_hill <span class="op">=</span> <span class="cn">FALSE</span>,              <span class="co"># Apply Hill function transformation</span></span>
<span>  hill_n <span class="op">=</span> <span class="fl">1</span>,                    <span class="co"># Hill coefficient</span></span>
<span>  hill_Kh <span class="op">=</span> <span class="fl">0.5</span>,                 <span class="co"># Half-maximal threshold</span></span>
<span>  normalize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parameter-deep-dive-1">Parameter Deep Dive<a class="anchor" aria-label="anchor" href="#parameter-deep-dive-1"></a>
</h3>
<div class="section level4">
<h4 id="weight_by_affinity-binding-strength-weighting">1. <code>weight_by_affinity</code>: Binding Strength Weighting<a class="anchor" aria-label="anchor" href="#weight_by_affinity-binding-strength-weighting"></a>
</h4>
<p>When <code>TRUE</code>, receptors are weighted by their metabolite
binding affinity from MetalinksDB:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show affinity scores for a metabolite</span></span>
<span><span class="va">receptors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMetaboliteReceptors.html">getMetaboliteReceptors</a></span><span class="op">(</span><span class="st">"Adenosine"</span>, include_transporters <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Adenosine receptors with affinity scores:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Adenosine receptors with affinity scores:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">receptors</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      gene_symbol       protein_type combined_score             metabolite</span></span>
<span><span class="co">#&gt; 3132       P2RY1               gpcr            999 Adenosine triphosphate</span></span>
<span><span class="co">#&gt; 3135        CFTR           other_ic            999 Adenosine triphosphate</span></span>
<span><span class="co">#&gt; 3104       P2RY2               gpcr            998 Adenosine triphosphate</span></span>
<span><span class="co">#&gt; 3187       P2RX1               lgic            998 Adenosine triphosphate</span></span>
<span><span class="co">#&gt; 3144       P2RX4               lgic            997 Adenosine triphosphate</span></span>
<span><span class="co">#&gt; 3150       ABCC8        transporter            997 Adenosine triphosphate</span></span>
<span><span class="co">#&gt; 3218      KCNJ11               vgic            995 Adenosine triphosphate</span></span>
<span><span class="co">#&gt; 3203       P2RX2               lgic            994 Adenosine triphosphate</span></span>
<span><span class="co">#&gt; 3209       ABCB1        transporter            994 Adenosine triphosphate</span></span>
<span><span class="co">#&gt; 3119        EGFR catalytic_receptor            988 Adenosine triphosphate</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="include_transporters-uptake-transporters">2. <code>include_transporters</code>: Uptake Transporters<a class="anchor" aria-label="anchor" href="#include_transporters-uptake-transporters"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare with and without transporters</span></span>
<span><span class="va">obj_with_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferSensing.html">inferSensing</a></span><span class="op">(</span><span class="va">obj</span>, include_transporters <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">obj_no_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferSensing.html">inferSensing</a></span><span class="op">(</span><span class="va">obj</span>, include_transporters <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Metabolites detected:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Metabolites detected:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  With transporters:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obj_with_trans</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   With transporters: 496</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Without transporters:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obj_no_trans</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Without transporters: 385</span></span></code></pre></div>
<p><strong>When to exclude transporters</strong>: If you only want
receptor-mediated signaling (not metabolic uptake).</p>
</div>
<div class="section level4">
<h4 id="use_hill-receptor-saturation-model">3. <code>use_hill</code>: Receptor Saturation Model<a class="anchor" aria-label="anchor" href="#use_hill-receptor-saturation-model"></a>
</h4>
<p>The Hill function models receptor binding saturation:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare linear vs Hill transformation</span></span>
<span><span class="va">obj_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferSensing.html">inferSensing</a></span><span class="op">(</span><span class="va">obj</span>, use_hill <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">obj_hill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inferSensing.html">inferSensing</a></span><span class="op">(</span><span class="va">obj</span>, use_hill <span class="op">=</span> <span class="cn">TRUE</span>, hill_n <span class="op">=</span> <span class="fl">1</span>, hill_Kh <span class="op">=</span> <span class="fl">0.5</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find a common metabolite</span></span>
<span><span class="va">common_met</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">obj_linear</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">)</span>, </span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">obj_hill</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">common_met</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj_linear</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">[</span><span class="va">common_met</span>, <span class="op">]</span>,</span>
<span>       <span class="va">obj_hill</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">[</span><span class="va">common_met</span>, <span class="op">]</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"Linear Sensing Score"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">"Hill-transformed Score"</span>,</span>
<span>       main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Effect of Hill Function on"</span>, <span class="va">common_met</span><span class="op">)</span>,</span>
<span>       pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="st">"#1976D2"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Hill parameter comparison</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Expression"</span>, ylab <span class="op">=</span> <span class="st">"Sensing Score"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Hill Function Parameters"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span><span class="op">^</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.3</span><span class="op">^</span><span class="fl">1</span> <span class="op">+</span> <span class="va">x</span><span class="op">^</span><span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span><span class="op">^</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.5</span><span class="op">^</span><span class="fl">1</span> <span class="op">+</span> <span class="va">x</span><span class="op">^</span><span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x</span><span class="op">^</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.7</span><span class="op">^</span><span class="fl">1</span> <span class="op">+</span> <span class="va">x</span><span class="op">^</span><span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"green"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, </span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Linear"</span>, <span class="st">"Kh=0.3"</span>, <span class="st">"Kh=0.5"</span>, <span class="st">"Kh=0.7"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="03-production-sensing_files/figure-html/hill_effect-1.png" alt="**Figure 3: Hill Function Effect on Sensing Scores.** Left: Comparison of linear vs Hill-transformed sensing scores for a metabolite. Points below the diagonal indicate saturation at high expression levels. Right: Different Kh values affect when saturation begins - lower Kh means earlier saturation." width="100%"><p class="caption">
<strong>Figure 3: Hill Function Effect on Sensing Scores.</strong> Left:
Comparison of linear vs Hill-transformed sensing scores for a
metabolite. Points below the diagonal indicate saturation at high
expression levels. Right: Different Kh values affect when saturation
begins - lower Kh means earlier saturation.
</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>When to use Hill function</strong>: - You expect receptor
saturation at high expression - Modeling dose-response relationships -
Biological realism is important</p>
</div>
</div>
<div class="section level3">
<h3 id="exploring-sensing-results">Exploring Sensing Results<a class="anchor" aria-label="anchor" href="#exploring-sensing-results"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sens_scores</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">@</span><span class="va">sensing_scores</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Sensing score matrix dimensions:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sens_scores</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sensing score matrix dimensions: 496 15</span></span>
<span></span>
<span><span class="co"># Top sensing cell types</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Top Glutamate Sensors ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Top Glutamate Sensors ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/getTopSensors.html">getTopSensors</a></span><span class="op">(</span><span class="va">obj</span>, <span class="st">"L-Glutamic acid"</span>, top_n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           cell_type sensing_score rank</span></span>
<span><span class="co">#&gt; 1 Normal Macrophage     0.7624215    1</span></span>
<span><span class="co">#&gt; 2               TAM     0.6192208    2</span></span>
<span><span class="co">#&gt; 3  Tumor Epithelial     0.4362282    3</span></span>
<span><span class="co">#&gt; 4          Gliacyte     0.4255517    4</span></span>
<span><span class="co">#&gt; 5 Normal Fibroblast     0.4229089    5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n=== Top Adenosine Sensors ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Top Adenosine Sensors ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/getTopSensors.html">getTopSensors</a></span><span class="op">(</span><span class="va">obj</span>, <span class="st">"Adenosine"</span>, top_n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           cell_type sensing_score rank</span></span>
<span><span class="co">#&gt; 1 Normal Macrophage     0.6479570    1</span></span>
<span><span class="co">#&gt; 2               TAM     0.5871354    2</span></span>
<span><span class="co">#&gt; 3          Pericyte     0.5663821    3</span></span>
<span><span class="co">#&gt; 4 Normal Fibroblast     0.4805927    4</span></span>
<span><span class="co">#&gt; 5               CAF     0.4760286    5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="receptor-analysis-for-a-metabolite">Receptor Analysis for a Metabolite<a class="anchor" aria-label="anchor" href="#receptor-analysis-for-a-metabolite"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get all receptors for a metabolite</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=== Serotonin (5-HT) Receptors ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; === Serotonin (5-HT) Receptors ===</span></span>
<span><span class="va">serotonin_receptors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getMetaboliteReceptors.html">getMetaboliteReceptors</a></span><span class="op">(</span><span class="st">"Serotonin"</span>, include_transporters <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">serotonin_receptors</span><span class="op">)</span></span>
<span><span class="co">#&gt;      gene_symbol protein_type combined_score metabolite</span></span>
<span><span class="co">#&gt; 2284        HTR7         gpcr            999  Serotonin</span></span>
<span><span class="co">#&gt; 2383       HTR1A         gpcr            999  Serotonin</span></span>
<span><span class="co">#&gt; 2287       HTR1B         gpcr            998  Serotonin</span></span>
<span><span class="co">#&gt; 2332       HTR2C         gpcr            998  Serotonin</span></span>
<span><span class="co">#&gt; 2385       HTR2B         gpcr            997  Serotonin</span></span>
<span><span class="co">#&gt; 2271        HTR4         gpcr            990  Serotonin</span></span>
<span><span class="co">#&gt; 2304        DRD2         gpcr            989  Serotonin</span></span>
<span><span class="co">#&gt; 2333        HTR6         gpcr            987  Serotonin</span></span>
<span><span class="co">#&gt; 2398       HTR1E         gpcr            987  Serotonin</span></span>
<span><span class="co">#&gt; 2273       HTR1F         gpcr            985  Serotonin</span></span>
<span><span class="co">#&gt; 2326       HTR5A         gpcr            973  Serotonin</span></span>
<span><span class="co">#&gt; 2359        DRD3         gpcr            964  Serotonin</span></span>
<span><span class="co">#&gt; 2484      TBXA2R         gpcr            956  Serotonin</span></span>
<span><span class="co">#&gt; 2265        DRD4         gpcr            950  Serotonin</span></span>
<span><span class="co">#&gt; 2356       OPRM1         gpcr            948  Serotonin</span></span>
<span><span class="co">#&gt; 2386       OPRD1         gpcr            940  Serotonin</span></span>
<span><span class="co">#&gt; 2267        DRD5         gpcr            939  Serotonin</span></span>
<span><span class="co">#&gt; 2264       PPARG          nhr            938  Serotonin</span></span>
<span><span class="co">#&gt; 2350       NTSR1         gpcr            938  Serotonin</span></span>
<span><span class="co">#&gt; 2502       NTSR2         gpcr            938  Serotonin</span></span>
<span><span class="co">#&gt; 2354      ADRA2A         gpcr            937  Serotonin</span></span>
<span><span class="co">#&gt; 2519        CNR1         gpcr            937  Serotonin</span></span>
<span><span class="co">#&gt; 2390        OPN4         gpcr            936  Serotonin</span></span>
<span><span class="co">#&gt; 2401        HRH2         gpcr            936  Serotonin</span></span>
<span><span class="co">#&gt; 2416       MCHR1         gpcr            936  Serotonin</span></span>
<span><span class="co">#&gt; 2458        MC1R         gpcr            935  Serotonin</span></span>
<span><span class="co">#&gt; 2286      NPBWR2         gpcr            934  Serotonin</span></span>
<span><span class="co">#&gt; 2374      ADRA1A         gpcr            934  Serotonin</span></span>
<span><span class="co">#&gt; 2437      ADRA2C         gpcr            934  Serotonin</span></span>
<span><span class="co">#&gt; 2516       TAAR1         gpcr            933  Serotonin</span></span>
<span><span class="co">#&gt; 2266       NMUR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2269       ADRB1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2270       ADRB2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2276      LTB4R2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2280       UTS2R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2285       GNRHR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2290       SSTR4         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2293        CCR3         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2297       OPRK1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2298        HRH4         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2299      PTGER1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2303       AVPR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2307        CCR5         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2310        CCR4         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2311       ACKR3         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2314       EDNRA         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2317      BDKRB1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2318     ADORA2A         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2321       GALR3         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2325        GHSR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2328       AGTR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2329        MLNR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2330       CXCR4         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2338        GRPR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2340      ADRA1D         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2341      PTGER3         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2343     ADORA2B         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2348      NPFFR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2351      ADRA1B         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2352      NPFFR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2355       SSTR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2358       SSTR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2362       LTB4R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2363      HCRTR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2364       LPAR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2366       PTGFR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2368      PROKR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2372       CCKBR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2378        MC5R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2380        MC2R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2384      PTGER2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2391      ADORA1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2393       NMUR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2396       RXFP4         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2403      HCRTR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2405       SSTR5         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2407       GALR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2415       PTGDR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2419       AGTR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2422       NPY2R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2425       LPAR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2427       MCHR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2429        CCR9         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2431       NPY5R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2434       NPSR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2436       OPRL1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2439       APLNR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2441       QRFPR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2442       RXFP3         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2443       LPAR3         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2447       CCKAR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2449       GALR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2452       ADRB3         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2454        MC4R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2460        OXTR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2465        MC3R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2467        CCR1         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2470      PROKR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2474      KISS1R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2479       PTGIR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2483        NMBR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2485      AVPR1A         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2492        CNR2         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2496        TRHR         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2497      PTGER4         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2503       GPR65         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2507       CXCR6         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2515       NPY1R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2524       NPY4R         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2530       EDNRB         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2531        HRH3         gpcr            928  Serotonin</span></span>
<span><span class="co">#&gt; 2370      GPR119         gpcr            393  Serotonin</span></span>
<span><span class="co">#&gt; 2466         RHO         gpcr            375  Serotonin</span></span>
<span><span class="co">#&gt; 2279       GPR39         gpcr            373  Serotonin</span></span>
<span><span class="co">#&gt; 2347       FFAR4         gpcr            373  Serotonin</span></span>
<span><span class="co">#&gt; 2305       GPR62         gpcr            367  Serotonin</span></span>
<span><span class="co">#&gt; 2459        OPN5         gpcr            360  Serotonin</span></span>
<span><span class="co">#&gt; 2272       GPR27         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2274       GPR19         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2277      GPR176         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2278       GPR61         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2281       TAAR5         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2296       GPR52         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2312      GPR139         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2315      GPR173         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2322       GPR83         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2323       GPR63         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2336        BRS3         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2344      OPN1LW         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2357      AVPR1B         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2360     GPR37L1         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2367       PRLHR         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2377      GPR142         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2379       GPR45         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2381       GPR26         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2394      OPN1SW         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2397       GPR85         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2408       TAAR2         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2410      GPR151         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2420      GPR148         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2433        GPR3         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2450       GPR78         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2451       TAAR8         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2463      GPR150         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2488       GPR22         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2489       GPR12         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2490      GPR135         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2498        OPN3         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2501       GPR88         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2504        GPR6         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2513       TAAR6         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2521       GPR84         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2532       GPR37         gpcr            310  Serotonin</span></span>
<span><span class="co">#&gt; 2282       HTR3B         lgic             NA  Serotonin</span></span>
<span><span class="co">#&gt; 2283     SLC36A1  transporter             NA  Serotonin</span></span>
<span><span class="co">#&gt; 2292       HTR1D         gpcr             NA  Serotonin</span></span>
<span><span class="co">#&gt; 2295        DRD1         gpcr             NA  Serotonin</span></span>
<span><span class="co">#&gt; 2402     CYSLTR1         gpcr             NA  Serotonin</span></span>
<span><span class="co">#&gt; 2468      SLC6A4  transporter             NA  Serotonin</span></span>
<span><span class="co">#&gt; 2493       HTR3A         lgic             NA  Serotonin</span></span>
<span><span class="co">#&gt; 2506       HTR2A         gpcr             NA  Serotonin</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="part-3-comparing-production-and-sensing">Part 3: Comparing Production and Sensing<a class="anchor" aria-label="anchor" href="#part-3-comparing-production-and-sensing"></a>
</h2>
<div class="section level3">
<h3 id="which-cell-types-are-producers-vs-sensors">Which Cell Types are Producers vs Sensors?<a class="anchor" aria-label="anchor" href="#which-cell-types-are-producers-vs-sensors"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get common metabolites</span></span>
<span><span class="va">common_mets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">production_scores</span><span class="op">)</span>, </span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">common_mets</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Average production and sensing per cell type</span></span>
<span>  <span class="va">avg_prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">production_scores</span><span class="op">[</span><span class="va">common_mets</span>, <span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">avg_sens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">[</span><span class="va">common_mets</span>, <span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">avg_prod</span>, <span class="va">avg_sens</span>,</span>
<span>       xlab <span class="op">=</span> <span class="st">"Average Production Potential"</span>,</span>
<span>       ylab <span class="op">=</span> <span class="st">"Average Sensing Capability"</span>,</span>
<span>       main <span class="op">=</span> <span class="st">"Cell Type Metabolic Roles"</span>,</span>
<span>       pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">"#1976D2"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">avg_prod</span>, <span class="va">avg_sens</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">avg_prod</span><span class="op">)</span>, pos <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Annotate quadrants</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">avg_prod</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.9</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">avg_sens</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.1</span>, <span class="st">"High Production\nLow Sensing"</span>, </span>
<span>       cex <span class="op">=</span> <span class="fl">0.8</span>, col <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">avg_prod</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">avg_sens</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.9</span>, <span class="st">"Low Production\nHigh Sensing"</span>, </span>
<span>       cex <span class="op">=</span> <span class="fl">0.8</span>, col <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="03-production-sensing_files/figure-html/prod_vs_sens-1.png" alt="**Figure 4: Cell Type Metabolic Roles.** Scatter plot comparing average production potential (x-axis) vs sensing capability (y-axis) for each cell type. Cell types above the diagonal are net sensors; those below are net producers." width="100%"><p class="caption">
<strong>Figure 4: Cell Type Metabolic Roles.</strong> Scatter plot
comparing average production potential (x-axis) vs sensing capability
(y-axis) for each cell type. Cell types above the diagonal are net
sensors; those below are net producers.
</p>
</div>
</div>
<div class="section level3">
<h3 id="metabolite-specific-roles">Metabolite-Specific Roles<a class="anchor" aria-label="anchor" href="#metabolite-specific-roles"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For a specific metabolite, which cells produce vs sense?</span></span>
<span><span class="va">met_name</span> <span class="op">&lt;-</span> <span class="st">"L-Lactic acid"</span></span>
<span><span class="va">met_id</span> <span class="op">&lt;-</span> <span class="st">"HMDB0000190"</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">met_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">production_scores</span><span class="op">)</span> <span class="op">&amp;&amp;</span> </span>
<span>    <span class="va">met_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">obj</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">prod</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">@</span><span class="va">production_scores</span><span class="op">[</span><span class="va">met_id</span>, <span class="op">]</span></span>
<span>  <span class="va">sens</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">@</span><span class="va">sensing_scores</span><span class="op">[</span><span class="va">met_id</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">prod</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">met_name</span>, <span class="st">"- Production"</span><span class="op">)</span>,</span>
<span>          col <span class="op">=</span> <span class="st">"#FF7043"</span>, cex.names <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">sens</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">met_name</span>, <span class="st">"- Sensing"</span><span class="op">)</span>,</span>
<span>          col <span class="op">=</span> <span class="st">"#42A5F5"</span>, cex.names <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="03-production-sensing_files/figure-html/metabolite_roles-1.png" alt="**Figure 5: Metabolite-Specific Production and Sensing.** Comparison of lactate production (left, orange) and sensing (right, blue) across cell types. This reveals the communication axis: producers release lactate that sensors can detect or uptake." width="100%"><p class="caption">
<strong>Figure 5: Metabolite-Specific Production and Sensing.</strong>
Comparison of lactate production (left, orange) and sensing (right,
blue) across cell types. This reveals the communication axis: producers
release lactate that sensors can detect or uptake.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<table class="table">
<colgroup>
<col width="20%">
<col width="53%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th>Step</th>
<th>Key Parameters</th>
<th>Output</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Production</strong></td>
<td>
<code>method</code>, <code>mean_method</code>,
<code>consider_degradation</code>
</td>
<td>
<code>@production_scores</code> matrix</td>
</tr>
<tr class="even">
<td><strong>Sensing</strong></td>
<td>
<code>weight_by_affinity</code>, <code>include_transporters</code>,
<code>use_hill</code>
</td>
<td>
<code>@sensing_scores</code> matrix</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>
<strong><a href="04-communication.html">Communication
Analysis</a></strong>: How to combine production and sensing</li>
<li>
<strong><a href="05-visualization.html">Visualization</a></strong>:
Advanced plotting options</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zaoqu Liu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
